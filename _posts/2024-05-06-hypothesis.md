---
title: "가설 검정 - 모평균 (t-test)"

categories:
  - datascience

---

## 가설검정
- 귀무가설 사실, 귀무가설 채택 - True Negative
- 귀무가설 사실, 귀무가설 기각 - False Positive (1종오류)
- 대립가설 사실, 귀무가설 채택 - False Negative (2종오류)
- 대립가설 사실, 귀무가설 기각 - True Positive
- 귀무가설은 보통 음성의 경우를 뜻하므로, 귀무가설을 채택하는 경우에는 negative 라고 말한다.

## p-value
- 귀무가설을 기각한 것이 오류일 확률 (type 1 error)
  - 귀무가설은 효과가 없다. 음성이다. 인데 우리가 얻은 데이터는 효과가 있다. 양성이다. 라는 증거를 발견한 것.
  - 그러면 **귀무가설이 참이라고 했을 때 우리가 이런 데이터를 우연히 얻을 수 있는 확률이 얼마인가?** 이걸 나타내는 값이 p-value 이다!
  - p-value 가 매우 작다면 얻은 결과가 우연히 발생할 가능성이 매우 낮다는 것이고, 효과가 있다는 강력한 증거가 된다.
  - p-value 가 크다면 현재 얻은 결과가 우연히 발생할 가능성이 높다는 것을 의미하고, 귀무가설을 기각할 수 없다.
- significance level, alpha (유의수준) - 귀무가설 기각을 판단하기 위한 pvalue 의 기준점
  - p-value 가 유의수준보다 크거나 같으면 귀무가설을 채택한다.

## 가설검정 절차
1. p-value(유의확률)에 의한 검정
   1. pvalue 를 계산하여 유의 수준과 비교하여 결론을 낸다.
2. 기각역에 의한 검정
   1. 기각역은 **귀무가설이 기각되고 대립가설이 채택되는 검정통계량의 영역**을 의미한다.
   2. 그러나 기각역 내에서도 귀무가설이 참이지만 귀무가설을 기각하는 확률은 존재한다. 이 확률이 유의수준이다.
      1. 일반적으로 유의수준은 5%로 정하지만, 1%, 10% 로 정하기도 한다.
      2. 유의수준이 5%이면, 검정통계량이 발생할 가능성이 5% 영역에서 발생하면 귀무가설이 맞을 가능성이 낮다고 판단한다는 의미이다.
      3. 기각역의 크기는 유의수준에 의해 결정되지만 위치는 대립가설에 의해 결정된다.
         1. 양측검정(모수가 특정값이 아니다), 단측검정(모수가 특정값보다 작다)

![Validation](/assets/images/critical.png){:width="=500px" height="300px"}{: .center}



## 예제 문제 1
1. 어느 기계의 평균 수명이 300일이라고 알려짐. 아니라는 주장이 나온다. 이때 해당 기계 25개를 표본으로 뽑아 조사하니 평균 수명이 310일이었다. 표준편차는 30일. 어느 의견이 더 타당한지 유의수준 5% 에서 검정하라.
   1. 대립가설 : 평균 수명 != 300일
   2. Z = 310 - 300 / (30 / sqrt(25)) = 1.67
   3. 기각역 : 유의수준이 0.05이므로 0.05/2=0.025 에 해당하는 값을 표준정규분포표에서 찾는다.
      1. 기각역 : +-1.96 
      2. 검정통계량인 1.67은 -1.96~1.96 사이인 채택역에 있으므로 귀무가설을 기각할 수 없다.

```python
from scipy import stats

xbar = 310
sigma = 30
n = 25

pvalue = 1 - stats.norm.cdf(xbar, loc=300, scale=sigma/np.sqrt(n)) * 2 
# 0.095로 0.05보다 크므로 귀무가설 기각할 수 없다.

critical_value = stats.norm.ppf(0.975, loc=300, scale=sigma/np.sqrt(n)) 
# 임계값 = 311.75로 검정통계량 310보다 크므로 기각역에 들어가지 않는다.
```

## 예제 문제 2

2. 과자 평균 중량이 50g 이라 주장한다. 소비자는 더 작다고 주장한다. 표본 100개 추출했더니, 평균 중량 41g이고 표준편차는 20g이다. 유의수준 1%에서 검정하여라.
   1. 대립가설 : 과자 평균 중량 < 50
   2. Z = 50 - 41 / (20 / sqrt(100)) = -4.5
   3. 기각역 : 유의수준이 0.01이므로 0.99에 해당하는 값을 표준정규분포표에서 찾는다.
      1. 기각역 : -2.33
      2. 검정통계량인 -4.5는 -2.33 보다 작으므로 기각역에 위치하므로 귀무가설을 기각한다.

```python
from scipy import stats
import numpy as np

xbar = 41
sigma = 20
n = 100

pvalue = 1 - stats.norm.cdf(xbar, loc=50, scale=sigma/np.sqrt(n)) * 2 
# 0.0003 으로 0.01 보다 매우 작으므로 귀무가설 기각한다.

critical_value = stats.norm.ppf(0.99, loc=50, scale=sigma/np.sqrt(n)) 
# 임계값 = 45.347로 검정통계량 41 보다 크므로 기각역에 들어간다. 
```

## 가설 검정 - 모평균
1. 단일 모집단의 평균 - 모집단의 평균에 대한 검정 (귀무가설 : mu = ?)
   1. 모분산 알고 있음. 모집단이 정규 분포 따르거나 n >= 25 일 때. 표본은 서로 독립 -> z 검정
   2. 모분산 모름. 모집단이 정규 분포 따름. 표본은 서로 독립 -> t 검정
2. 서로 다른 두 모집단의 평균 - 서로 다른 두 개 범주에 속한 모집단의 mu1, mu2 에 대한 검정 (귀무가설 : mu1 = mu2)
   1. 두 모집단은 정규 분포를 따르고, 각 표본들은 서로 독립 -> independent t-test (t-독립성 검정)
      1. 모분산이 같은 경우 - 
      2. 모분산이 다른 경우 - Welch's t-test
   2. 모집단에 대한 가정이 필요하지 않은 비모수 검정법 - Mann-Whitney U 검정
      1. 순위 기반으로 모집단 평균에 대한 비교라기 보다는 대소 관계에 대한 비교
3. 동일 개체의 두 모집단 평균 - 동일 개체에서 treatment 전후의 두 모집단의 평균 비교 (귀무가설 : mu0 = mu0')
   1. 모집단 정규 분포 따르고, 각 표본들은 서로 독립 -> paired t-test
   2. 모집단에 대한 가정이 필요하지 않은 비모수 검정법 - Wilcoxon's Signed-rank Test
      1. 귀무가설 : 두 모집단은 동일한 분포를 지녔다.

## t-test
- **두 집단의 평균을 비교**하는 검정 방법
- 귀무가설 : 두 집단의 평균값의 차이가 없다.
- 대립가설 : 두 집단의 평균값의 차이가 있다.
- 가정 : 표본의 독립성, 정규성, 등분산성

## t-test 종류
- one sample t-test : 한 집단의 평균이 모집단의 평균과 같은지 비교한다.
  - 모집단의 평균을 알고 있지만, 표준편차는 모른다.
  - 모집단은 정규 분포를 따르고 각 표본은 서로 독립이다.
  - z = (표본 평균 - 모평균) / (표준편차 / sqrt(n)) 에서 표준편차 대신 표본표준편차를 사용한다.
  - df = n - 1
- independent t-test : 서로 다른 모집단에서 추출된 두 독립된 집단의 평균의 차이를 비교한다.
- paired t-test : 하나의 집단의 전/후의 차이를 비교한다.
  - 두 집단이 독립적이지 않다.

## paired t-test
- pair 를 이루는 집단에서 각 pair 의 차이로 두 모집단의 평균이 같을지를 검정한다.
- 귀무가설 : 각 pair의 차이의 평균은 0이다.
- 대립가설 : 각 pair의 차이의 평균은 0이 아니다. or < 0 or > 0

![Validation](/assets/images/pairedttest.png){:width="=200px" height="100px"}{: .center}
- d : 두 집단 차이의 평균
- s : 두 집단 차이의 표본 표준편차
- n : 표본의 수 (pair 의 수)
- df : n-1 (n : pair의 수)
