---
title: "Layered Architecture Style/Pattern"

categories:
  - architecturestyle

tags:
  - architecturestyle
---

### 소프트웨어 아키텍처와 뷰의 관계
- 아키텍처는 여러 개의 뷰 관점이 필요하다.
- view
  - 시스템을 이루는 요소들의 집합과 그들의 연관 관계를 추상적으로 표현한 것
- viewpoint(view type)
  - view 를 구조화 하는 관점
- style
  - 소프트웨어 제약 사항을 표현할 수 있는 구성 요소와 연관관계의 특별한 type

### Layered Architecture Style
- 소프트웨어를 레이어 단위로 분할한다.
- 각 레이어는 인터페이스를 가진 가상 머신
- 가상 머신은 엄격한 순서 관계에 따라 상호작용 한다.
  - 수평적인 관계가 아닌 수직적 관계
  - layer a가 layer b의 상위 레이어라면, layer a  는 layer b 에 의해 제공되는 서비스의 사용이 허락된다. **(allowed to use)**
    - 꼭 사용한다는건 아니고, (사용허가)사용해도 된다.
  - 그러나, 하위 레이어는 상위 레이어 사용이 불가하다.
- 스타일과 패턴에서의 가장 큰 차이!
  - 스타일에서는 상위 레이어는 바로 아래의 하위 레이어뿐만 아니라, 임의의 하위 레이어 모두 사용 가능하다.
- Virtual Machine
  - 레이어의 목적은 가상 머신의 제공
  - 이식성(Portability) 향상이 목적이다.
    - 특정 플랫폼에 종속적 기능이 노출되지 않고, 독립적인 추상 인터페이스로 은폐한다.
- 사용 허가 관계
  - 레이어가 낮을수록 더 적은 기능이 사용된다. 낮은 레이어는 특정 어플리케이션에 더 독립적이지만, 플랫폼에는 종속적이다.
  -  높은 레이어는 플랫폼에는 독립적이지만, 특정 application 의 세부사항에 관련이 높다.
-  layer 는 소스 코드를 통해 유도될 수 없다.
   -  사용 관계는 소스 코드에 표현 가능하지만, 사용 허가 관계는 표현이 안된다.


### 특징
- 요소 - 레이어
- 관계 - 사용 허가 관계
- 요소의 속성
  - 레이어 이름, 레이어가 포함하는 sw 단위, 사용 허가된 sw, 응집도
- 토폴로지
  - 순환적 구조 불가능. 상위 레이어와 하위 레이어의 관계는 고정된다. 역전될 수 없다. 
  - 모든 sw 의 부분은 정확히 한 레이어에 존재한다. 하나의 모듈이 여러 레이어에 걸쳐 존재할 수 없다.


### Situation
- 수정 용이성과 이식성 향상
  - information hiding
    - 하위 레이어의 변경은 인터페이스 뒤에서 은폐된다.
    - 상황에 따라 하위 레이어의 변경이 상위 레이어에게 영향을 안미칠 수도 있다.
- 실행시간 오버헤드가 없다.
- 시스템 구축을 위한 청사진 역할 - 개발 환경에서 어떤 서비스에 의존 가능한지 확인
- 레이어로 분할함으로써 복잡도 관리와 구조에 대한 의사전달의 역할
- 설계 변경 시 미치는 영향의 분석을 도와준다.


### Notation - 비정형적 표현
- Stack
  - 레이어를 사각형 스택으로 표현한다.
  - 인접하거나 화살표를 통해 사용 허가 관계를 표현한다.
  - 위에서부터 아래로 상위-> 하위.
- Segmented Layers
  - 레이어를 더 작은 단위의 모듈 집합인 세그먼트로 분할
  - 기존의 단위 집합이 동일한 사용 허가 관계를 공유하는 경우
- Ring
  - 바깥쪽에서 안쪽으로 상위->하위
  - 세그먼트 레이어 3개 이상 사용시, 스택과 링에서의 의미가 다를 수 있다.
    - 스택은 인접한 세그먼트 레이어간만 사용 허가 관계가 있다.
    - 링에서는 모두가 서로 인접하므로 모두 서로 사용 허가 관계가 있다.
- 사이드카(e.g., sw utilities) 를 가진 레이어
  - D 내부 모듈은 A,B,C 내의 모듈 사용 가능
  - A,B,C 내의 모듈은 D 내부의 모듈 사용 가능
- 레이어를 구성하는 모듈도 스택 내 사각형으로 표현 가능하다.
  - 모듈의 크기와 색상을 사용해 구별되는 특징과 개발팀을 표현하고, 모듈의 상대적 크기를 나타낸다.
- Interface
  - 스택 내의 사각형에 레이어에 대한 인터페이스 표시
  - 레이어 간의 사용은 인터페이스를 통해서만 가능하다.
  - 내부에는 직접적으로 접근이 불가하다.


![Validation](/assets/images/layered.PNG){:width="500px" height="300px"}{: .center}


### Notation - UML
- UML 은 레이어에 대한 표기법을 내장하지는 않는다.
- 세그먼트를 가지지 않는 layer 는 package 로 표현한다.
  - 또는, <\<Layer>> 스테레오 타입을 사용한다.
  - dependency 화살표 위에 <\<allowed to use>> 의존성 표기 한다.


### 다른 스타일들과 비교
- 1. 모듈 분할
  - 레이어가 모듈일 수 있지만, 항상 모듈은 아니다.
  - 모듈은 더 작은 모듈로 분할 가능하지만, 레이어는 더 작은 레이어로 분할이 불가능하다.
  - 레이어와 모듈 간에 항상 1:1 매핑은 아니다.
    - 레이어는 여러 모듈로 구성 가능하다.
    - 모듈은 여러 개의 레이어로 구성 가능하다.
- 2. Tier
  - layer != tier
    - 레이어는 표시하지 않지만 티어에서는 표시되는 정보
      - 분산 환경 하의 하드웨어에 대한 할당
      - 요소들간의 데이터 흐름
      - 통신 채널 사용과 존재 표현
    - 티어는 동적인 뷰에서도 표현이 가능하지만, 레이어는 정적인 관계를 표현하므로 나타나지 않는다.
    - 티어는 관계가 양방향이나 대칭적인데, 레이어는 양방향이 안된다.
    - 실행 시간 효율을 위해 티어에 모듈을 할당할 수 있고, 변경이나 부분집합 개발의 용이성을 위해 레이어 모듈 할당 가능하다.
- 3. 모듈 사용 스타일
  - 레이어 스타일과 사용 스타일은 밀접한 관계
  - 어떤 사용 관계도 사용 허가 관계를 위배하면 안된다. 
    - 사용 허가 관계가 사용 관계 포함한다.
  - 대부분 allowed to use 관계로 시작해서, 후에 실제적인 사용 관계로 문서화한다.
- 4. subsystems
  - 서브시스템은 상위 레이어의 세그먼트와 하위 레이어의 세그먼트로 구성된다.

### Layered Architecture Pattern
- Context
  - 시스템의 규모가 커서 분해할 필요가 있는 상황
- Problem
  - 하위 레벨과 상위 레벨의 이슈가 서로 혼재된 시스템 설계
  - 시스템 기능이 수직적으로 나눠있거나 수평적인 경우와 혼재
- Solution
  - 최하위 계층 Layer n ~ 최상위 계층 Layer 1
  - 상위 레이어는 바로 아래의 하위 레이어가 제공하는 서비스만 사용한다.



### Discussion
- 장점
  - loosely coupling 원칙 준수
  - 코딩이나 테스트를 계층별로 진행할 수 있다.
  - 인터페이스만 잘 정의되어 있으면 계층을 통째로 교체 가능하다.
  - 모듈의 재사용성을 높여 유지보수성이나 이식성이 필요한 시스템에 적용하기 좋다.
- 단점
  - 계층 원칙 준수를 위해 각 계층을 모두 거쳐야 하므로 성능 측면에서 불이익
  - 계층 구분 어렵고, 잘못 구분하면 계속 수정 필요
  - 계층의 적절한 개수 및 규모 정의가 어렵다.
  